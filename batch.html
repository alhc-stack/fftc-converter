<!DOCTYPE html>
<html>
<head>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f0f0f0">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-512.png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Batch Footage ↔ Timecode Converter</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      padding: 20px;
      max-width: 1200px;
      margin: auto;
      background-color: #f5f5f5;
    }
    h2 {
      text-align: center;
      margin-bottom: 10px;
      font-size: 24px;
    }
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 20px;
      font-size: 14px;
    }
    .row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      align-items: flex-end;
    }
    .row-item {
      flex: 1;
    }
    label {
      display: flex;
      align-items: flex-end;
      min-height: 2.5em;
      margin-bottom: 8px;
      font-weight: bold;
      font-size: 16px;
    }
    .section {
      margin-top: 20px;
      padding: 20px;
      border-radius: 12px;
      background-color: #ffffff;
      box-shadow: 0 2px 8px #0000001a;
    }
    select, input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background-color: white;
    }
    textarea {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      font-size: 14px;
      font-family: 'Courier New', monospace;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
    }
    .input-header {
      display: flex;
      align-items: last baseline;
      gap: 10px;
      margin-bottom: 8px;
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    button {
      flex: 1;
      padding: 14px;
      font-size: 16px;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }
    .convert-btn {
      background-color: #20bf55;
    }
    .convert-btn:hover {
      background-color: #1da54a;
    }
    .clear-btn {
      background-color: #d63230;
      flex: 0.3;
    }
    .clear-btn:hover {
      background-color: #ba170b;
    }
    .export-btn {
      background-color: #118ab2;
      flex: 0.5;
    }
    .export-btn:hover {
      background-color: #10779a;
    }
    .copy-btn {
      background-color: #f39237;
      flex: 0.5;
    }
    .copy-btn:hover {
      background-color: #dd832e;
    }
    button:active {
      transform: scale(0.98);
    }
    .results-section {
      margin-top: 20px;
      display: none;
    }
    .summary {
      padding: 15px;
      background-color: #e3f2fd;
      border-radius: 8px;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .summary.error {
      background-color: #ffebee;
      color: #c62828;
    }
    .summary.success {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f5f5f5;
      font-weight: bold;
      color: #333;
    }
    tr:hover {
      background-color: #f9f9f9;
    }
    .status-success {
      color: #20bf55;
      font-weight: bold;
    }
    .status-error {
      color: #d63230;
      font-weight: bold;
    }
    .help-text {
      font-size: 13px;
      color: #666;
      margin-top: 5px;
    }
    .message {
      padding: 12px;
      border-radius: 8px;
      margin-top: 10px;
      text-align: center;
      font-weight: bold;
    }
    .message.success {
      background-color: #e8f5e9;
      color: #2e7d32;
    }
    .message.error {
      background-color: #ffebee;
      color: #c62828;
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      body {
        padding: 15px;
      }
      h2 {
        font-size: 20px;
        margin-bottom: 10px;
      }
      .subtitle {
        font-size: 13px;
        margin-bottom: 15px;
      }
      .section {
        padding: 15px;
      }
      .row {
        flex-direction: column;
        gap: 0;
      }
      .row-item {
        width: 100%;
        margin-bottom: 10px;
      }
      label {
        font-size: 14px;
      }
      .input-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      #feetOnlyLabel {
        font-size: 14px !important;
        padding: 8px;
        background-color: #f5f5f5;
        border-radius: 6px;
        width: 100%;
        justify-content: flex-start;
      }
      textarea {
        min-height: 150px;
        font-size: 13px;
      }
      .help-text {
        font-size: 12px;
      }
      button {
        padding: 12px;
        font-size: 15px;
      }
      .clear-btn {
        flex: 0.4;
      }
      th, td {
        padding: 8px;
        font-size: 13px;
      }
      .summary {
        padding: 12px;
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      h2 {
        font-size: 18px;
      }
      .section {
        padding: 12px;
        margin-top: 15px;
      }
      label {
        font-size: 13px;
      }
      #feetOnlyLabel {
        font-size: 13px !important;
      }
      th, td {
        padding: 6px;
        font-size: 12px;
      }
      .copy-btn, .export-btn {
        font-size: 13px;
        padding: 10px 8px;
      }
    }

  </style>
</head>
<body>
  <h2>Batch Footage ↔ Timecode Converter</h2>
  <p class="subtitle">Convert multiple values at once</p>

  <!-- Settings Section -->
  <div class="section">
    <div class="row">
      <div class="row-item">
        <label for="mode">Conversion Mode</label>
        <select id="mode">
          <option value="ftc">Footage → Timecode</option>
          <option value="ctf">Timecode → Footage</option>
        </select>
      </div>
      <div class="row-item">
        <label for="fpsSelect">Frame Rate</label>
        <select id="fpsSelect">
          <option value="23.98/24">23.98/24</option>
          <option value="25">25</option>
        </select>
      </div>
      <div class="row-item">
        <label for="reel">Reel Number</label>
        <input type="number" id="reel" value="1" min="0">
      </div>
    </div>
  </div>

  <!-- Input Section -->
  <div class="section">
    <div class="input-header">
      <label for="input" style="margin: 0;">Input (one per line)</label>
      <label id="feetOnlyLabel" style="display: flex; align-items: center; gap: 5px; font-weight: normal; font-size: 16px; margin: 0; cursor: pointer; white-space: nowrap;">
        <input type="checkbox" id="feetOnly" onchange="updateHelpText()" style="cursor: pointer;">
        Feet Only (no frames)
      </label>
    </div>
    <p class="help-text" id="formatHelp">Format: Feet+Frames (e.g., 100+05, 250+12, 0+08)</p>
    <textarea id="input" placeholder="Enter values here, one per line..."></textarea>
    <div class="button-group">
      <button class="convert-btn" onclick="batchConvert()">Convert All</button>
      <button class="clear-btn" onclick="clearAll()">Clear</button>
    </div>
  </div>

  <!-- Results Section -->
  <div class="section results-section" id="resultsSection">
    <div class="summary" id="summary"></div>
    <div style="overflow-x: auto;">
      <table id="resultsTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Input</th>
            <th>Output</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="resultsBody">
        </tbody>
      </table>
    </div>
    <div class="button-group">
      <button class="copy-btn" onclick="copyResults()">Copy Table</button>
      <button class="export-btn" onclick="exportTXT()">Export TXT</button>
    </div>
    <div id="message"></div>
  </div>

  <script>
    // Update format help text when mode changes
    document.getElementById('mode').addEventListener('change', function() {
      updateHelpText();
    });

    // Update help text based on mode and feetOnly checkbox
    function updateHelpText() {
      const mode = document.getElementById('mode').value;
      const feetOnly = document.getElementById('feetOnly');
      const feetOnlyLabel = document.getElementById('feetOnlyLabel');
      const helpText = document.getElementById('formatHelp');
      
      if (mode === 'ftc') {
        if (feetOnly && feetOnly.checked) {
          helpText.textContent = 'Format: Feet only (e.g., 100, 250, 1350)';
        } else {
          helpText.textContent = 'Format: Feet+Frames (e.g., 100+05, 250+12, 0+08)';
        }
        // Show checkbox only in footage mode
        if (feetOnlyLabel) feetOnlyLabel.style.display = 'flex';
      } else {
        helpText.textContent = 'Format: HH:MM:SS:FF (e.g., 01:23:45:12, 00:05:30:00)';
        // Hide checkbox in timecode mode
        if (feetOnlyLabel) feetOnlyLabel.style.display = 'none';
      }
    }

    function isValidInteger(value) {
      if (typeof value !== 'string') return false;
      if (value === '') return true;
      if (/[eE\.\+\-]/.test(value)) return false;
      const num = Number(value);
      return Number.isInteger(num) && num >= 0;
    }

    function convertFootageToTimecode(feet, frames, fps, reel) {
      const totalFrames = feet * 16 + frames;
      const hh = Math.floor(totalFrames / (fps * 3600)) + reel;
      const mm = Math.floor((totalFrames / (fps * 60)) % 60);
      const ss = Math.floor((totalFrames / fps) % 60);
      const ff = totalFrames % fps;
      return `${String(hh).padStart(2, '0')}:${String(mm).padStart(2, '0')}:${String(ss).padStart(2, '0')}:${String(ff).padStart(2, '0')}`;
    }

    function convertTimecodeToFootage(timecode, fps, reel) {
      const parts = timecode.split(':').map(Number);
      if (parts.length !== 4 || parts.some(isNaN)) {
        throw new Error('Invalid timecode format');
      }
      const [hh, mm, ss, ff] = parts;
      if (ff >= fps) {
        throw new Error(`Frame value exceeds FPS`);
      }
      if (reel > hh) {
        throw new Error('Reel > HH');
      }
      const adjustedHours = Math.max(0, hh - reel);
      const totalFrames = adjustedHours * fps * 3600 + mm * fps * 60 + ss * fps + ff;
      if (totalFrames < 0) {
        throw new Error('Timecode before reel start');
      }
      const feet = Math.floor(totalFrames / 16);
      const frames = totalFrames % 16;
      return `${feet}+${String(frames).padStart(2, '0')}`;
    }

    function batchConvert() {
      const mode = document.getElementById('mode').value;
      const fpsOption = document.getElementById('fpsSelect').value;
      const fps = (fpsOption === '23.98/24') ? 24 : 25;
      const reel = parseInt(document.getElementById('reel').value) || 1;
      const input = document.getElementById('input').value.trim();

      if (!input) {
        showMessage('Please enter values to convert', 'error');
        return;
      }

      const lines = input.split('\n').filter(line => line.trim() !== '');
      const results = [];
      let successCount = 0;
      let errorCount = 0;

      lines.forEach((line, index) => {
        const trimmedLine = line.trim();
        let output = '';
        let status = '';
        let error = false;
        let displayInput = trimmedLine; // This will be shown in the table

        try {
          if (mode === 'ftc') {
            // Check if "Feet Only" mode is enabled
            const feetOnlyCheckbox = document.getElementById('feetOnly');
            const isFeetOnly = feetOnlyCheckbox && feetOnlyCheckbox.checked;
            
            let feet, frames;
            
            if (isFeetOnly) {
              // Feet Only mode: accept just numbers
              const feetMatch = trimmedLine.match(/^\d+$/);
              if (!feetMatch) {
                throw new Error('Invalid feet format (numbers only)');
              }
              feet = parseInt(trimmedLine);
              frames = 0; // Automatically set frames to 0
              displayInput = `${feet}+00`; // Add +00 for display
            } else {
              // Normal mode: Feet+Frames format
              const match = trimmedLine.match(/^(\d+)\+(\d+)$/);
              if (!match) {
                throw new Error('Invalid footage format');
              }
              feet = parseInt(match[1]);
              frames = parseInt(match[2]);
              
              if (frames > 15) {
                throw new Error('Frames > 15');
              }
            }
            
            output = convertFootageToTimecode(feet, frames, fps, reel);
            status = '✓ Success';
            successCount++;
          } else {
            // Timecode to Footage
            output = convertTimecodeToFootage(trimmedLine, fps, reel);
            status = '✓ Success';
            successCount++;
          }
        } catch (e) {
          output = '—';
          status = `✗ Error: ${e.message}`;
          error = true;
          errorCount++;
        }

        results.push({
          number: index + 1,
          input: displayInput, // Use displayInput instead of trimmedLine
          output: output,
          fps: fpsOption,
          reel: reel,
          status: status,
          error: error
        });
      });

      displayResults(results, successCount, errorCount, mode, fpsOption, reel);
    }

    function displayResults(results, successCount, errorCount, mode, fps, reel) {
      const resultsSection = document.getElementById('resultsSection');
      const summary = document.getElementById('summary');
      const tbody = document.getElementById('resultsBody');

      // Show results section
      resultsSection.style.display = 'block';

      // Update summary
      const total = successCount + errorCount;
      summary.innerHTML = `Total: ${total} | Success: <span style="color: #20bf55;">${successCount}</span> | Errors: <span style="color: #d63230;">${errorCount}</span>`;
      
      if (errorCount === 0) {
        summary.className = 'summary success';
      } else if (successCount === 0) {
        summary.className = 'summary error';
      } else {
        summary.className = 'summary';
      }

      // Clear and populate table
      tbody.innerHTML = '';
      results.forEach(result => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${result.number}</td>
          <td>${result.input}</td>
          <td>${result.output}</td>
          <td class="${result.error ? 'status-error' : 'status-success'}">${result.status}</td>
        `;
      });

      // Store results and settings globally for export
      window.batchResults = results;
      window.batchSettings = { mode, fps, reel };

      // Scroll to results
      resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function copyResults() {
      const table = document.getElementById('resultsTable');
      let text = '';
      
      // Copy as tab-separated values (works well with Excel)
      for (let row of table.rows) {
        let rowData = [];
        for (let cell of row.cells) {
          rowData.push(cell.textContent);
        }
        text += rowData.join('\t') + '\n';
      }

      navigator.clipboard.writeText(text).then(() => {
        showMessage('Table copied to clipboard! You can paste it into Excel or Google Sheet.', 'success');
      }).catch(err => {
        showMessage('Failed to copy table', 'error');
      });
    }

    function exportTXT() {
      if (!window.batchResults || !window.batchSettings) return;

      const { mode, fps, reel } = window.batchSettings;
      const modeText = mode === 'ftc' ? 'Footage → Timecode' : 'Timecode → Footage';

      let txt = 'Batch Conversion Results\n';
      txt += `Mode: ${modeText}\n`;
      txt += `FPS: ${fps}\n`;
      txt += `Reel: ${reel}\n`;
      txt += '\n';

      // Formatting Each Column
      const numWidth = Math.max(...window.batchResults.map(r => String(r.number).length)) + 2;
      const inputWidth = Math.max(...window.batchResults.map(r => String(r.input).length)) + 4;
      const outputWidth = Math.max(...window.batchResults.map(r => String(r.output).length)) + 4;
      const statusWidth = Math.max(...window.batchResults.map(r => String(r.status).length)) + 2;
      const pad = (str, len) => String(str).padEnd(len, ' ');

      const header =
      pad('#', numWidth) +'\t'+ pad('Input', inputWidth)+'\t'+ pad('Output', outputWidth)+'\t'+ pad('Status', statusWidth);

      txt += header + '\n';

      window.batchResults.forEach(result => {
      const num = pad(result.number, numWidth);
      const input = pad(result.input, inputWidth);
      const output = pad(result.output, outputWidth);
      const status = pad(result.status, statusWidth);
      txt += `${num}\t${input}\t${output}\t${status}\n`;});

      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = String(now.getMonth() + 1).padStart(2, '0');
      const dd = String(now.getDate()).padStart(2, '0');
      const hh = String(now.getHours()).padStart(2, '0');
      const min = String(now.getMinutes()).padStart(2, '0');

      const timestamp = `${yyyy}-${mm}-${dd}_${hh}-${min}`;
      const filename = `batch-conversion_${timestamp}.txt`;
      
      downloadFile(txt, filename, 'text/plain');
      showMessage('TXT file downloaded!', 'success');
    }

    function downloadFile(content, filename, mimeType) {
      const blob = new Blob([content], { type: mimeType });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function clearAll() {
      document.getElementById('input').value = '';
      document.getElementById('resultsSection').style.display = 'none';
      document.getElementById('message').innerHTML = '';
      window.batchResults = null;
      window.batchSettings = null;
    }

    function showMessage(text, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = text;
      messageDiv.className = `message ${type}`;
      setTimeout(() => {
        messageDiv.textContent = '';
        messageDiv.className = 'message';
      }, 3000);
    }

    // Initialize help text on page load
    document.addEventListener('DOMContentLoaded', function() {
      updateHelpText();
    });
  </script>
</body>
</html>
